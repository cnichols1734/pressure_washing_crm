{% extends "base.html" %}

{% block title %}{% if client %}Edit{% else %}New{% endif %} Client - AquaCRM{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-100 dark:from-slate-900 dark:via-gray-900 dark:to-slate-900 py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-3xl mx-auto">
        <!-- Header -->
        <div class="relative overflow-hidden rounded-3xl bg-white dark:bg-gray-800 shadow-xl ring-1 ring-black/5 dark:ring-white/10 mb-8">
            <div class="absolute inset-0 bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900"></div>
            <div class="relative px-8 py-8">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                    <div class="space-y-2">
                        <h1 class="text-2xl font-semibold text-white tracking-tight">
                            {% if client %}Edit Client{% else %}Add New Client{% endif %}
                        </h1>
                        <p class="text-slate-300 text-base">{% if client %}Update client information{% else %}Create a new client profile for your business{% endif %}</p>
                    </div>
                    <div class="mt-6 lg:mt-0">
                        <a href="{{ url_for('clients.index') }}" 
                           class="inline-flex items-center gap-2 rounded-xl bg-white dark:bg-gray-100 px-6 py-3 text-sm font-medium text-slate-900 shadow-lg hover:bg-slate-50 dark:hover:bg-gray-200 transition-all duration-200 hover:scale-105">
                            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                            </svg>
                            Back to Clients
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Card -->
        <div class="rounded-2xl bg-white dark:bg-gray-800 shadow-lg ring-1 ring-black/5 dark:ring-white/10 overflow-hidden">
            <div class="px-6 py-5 border-b border-slate-100 dark:border-slate-700 bg-slate-50/50 dark:bg-slate-800/50">
                <div class="flex items-center gap-3">
                    <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-slate-100 dark:bg-slate-700">
                        <svg class="h-5 w-5 text-slate-600 dark:text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-lg font-semibold text-slate-900 dark:text-slate-100">Client Information</h2>
                        <p class="text-sm text-slate-600 dark:text-slate-400">Fill in the details to {% if client %}update{% else %}create{% endif %} a client profile</p>
                    </div>
                </div>
            </div>
            
            <form method="POST" class="p-8">
                {{ form.csrf_token }}
                
                <!-- Basic Information Section -->
                <div class="space-y-6 mb-10">
                    <div class="flex items-center gap-3 pb-4 border-b border-slate-100 dark:border-slate-700">
                        <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-slate-100 dark:bg-slate-700">
                            <svg class="h-4 w-4 text-slate-600 dark:text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V4a2 2 0 118 0v2m-4 0a2 2 0 104 0m-4 0a2 2 0 014 0z" />
                            </svg>
                        </div>
                        <h3 class="text-base font-semibold text-slate-900 dark:text-slate-100">Basic Information</h3>
                    </div>
                    
                    <div>
                        <label for="{{ form.name.id }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                            {{ form.name.label }} <span class="text-red-500">*</span>
                        </label>
                        {{ form.name(class="block w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-700/50 py-3 px-4 text-slate-900 dark:text-slate-100 ring-1 ring-inset ring-slate-200 dark:ring-slate-600 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:ring-2 focus:ring-slate-600 dark:focus:ring-slate-400 transition-all") }}
                        {% if form.name.errors %}
                        <div class="text-red-500 dark:text-red-400 text-sm mt-2">
                            {% for error in form.name.errors %}
                            <p class="flex items-center gap-1">
                                <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                {{ error }}
                            </p>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="{{ form.email.id }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                                {{ form.email.label }} <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <svg class="h-4 w-4 text-slate-400 dark:text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207" />
                                    </svg>
                                </div>
                                {{ form.email(class="pl-12 block w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-700/50 py-3 pr-4 text-slate-900 dark:text-slate-100 ring-1 ring-inset ring-slate-200 dark:ring-slate-600 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:ring-2 focus:ring-slate-600 dark:focus:ring-slate-400 transition-all") }}
                            </div>
                            {% if form.email.errors %}
                            <div class="text-red-500 dark:text-red-400 text-sm mt-2">
                                {% for error in form.email.errors %}
                                <p class="flex items-center gap-1">
                                    <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    {{ error }}
                                </p>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div>
                            <label for="{{ form.phone.id }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">{{ form.phone.label }}</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <svg class="h-4 w-4 text-slate-400 dark:text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                    </svg>
                                </div>
                                {{ form.phone(class="pl-12 block w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-700/50 py-3 pr-4 text-slate-900 dark:text-slate-100 ring-1 ring-inset ring-slate-200 dark:ring-slate-600 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:ring-2 focus:ring-slate-600 dark:focus:ring-slate-400 transition-all") }}
                            </div>
                            {% if form.phone.errors %}
                            <div class="text-red-500 dark:text-red-400 text-sm mt-2">
                                {% for error in form.phone.errors %}
                                <p class="flex items-center gap-1">
                                    <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    {{ error }}
                                </p>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Address Section -->
                <div class="space-y-6">
                    <div class="flex items-center gap-3 pb-4 border-b border-slate-100 dark:border-slate-700">
                        <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-slate-100 dark:bg-slate-700">
                            <svg class="h-4 w-4 text-slate-600 dark:text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                        </div>
                        <h3 class="text-base font-semibold text-slate-900 dark:text-slate-100">Address Information</h3>
                    </div>
                    
                    <div>
                        <label for="{{ form.address1.id }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">{{ form.address1.label }}</label>
                        {{ form.address1(class="block w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-700/50 py-3 px-4 text-slate-900 dark:text-slate-100 ring-1 ring-inset ring-slate-200 dark:ring-slate-600 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:ring-2 focus:ring-slate-600 dark:focus:ring-slate-400 transition-all") }}
                        {% if form.address1.errors %}
                        <div class="text-red-500 dark:text-red-400 text-sm mt-2">
                            {% for error in form.address1.errors %}
                            <p class="flex items-center gap-1">
                                <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                {{ error }}
                            </p>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <div>
                        <label for="{{ form.address2.id }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">{{ form.address2.label }}</label>
                        {{ form.address2(class="block w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-700/50 py-3 px-4 text-slate-900 dark:text-slate-100 ring-1 ring-inset ring-slate-200 dark:ring-slate-600 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:ring-2 focus:ring-slate-600 dark:focus:ring-slate-400 transition-all") }}
                        {% if form.address2.errors %}
                        <div class="text-red-500 dark:text-red-400 text-sm mt-2">
                            {% for error in form.address2.errors %}
                            <p class="flex items-center gap-1">
                                <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                {{ error }}
                            </p>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <label for="{{ form.city.id }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">{{ form.city.label }}</label>
                            {{ form.city(class="block w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-700/50 py-3 px-4 text-slate-900 dark:text-slate-100 ring-1 ring-inset ring-slate-200 dark:ring-slate-600 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:ring-2 focus:ring-slate-600 dark:focus:ring-slate-400 transition-all") }}
                            {% if form.city.errors %}
                            <div class="text-red-500 dark:text-red-400 text-sm mt-2">
                                {% for error in form.city.errors %}
                                <p class="flex items-center gap-1">
                                    <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    {{ error }}
                                </p>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div>
                            <label for="{{ form.state.id }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">{{ form.state.label }}</label>
                            {{ form.state(class="block w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-700/50 py-3 px-4 text-slate-900 dark:text-slate-100 ring-1 ring-inset ring-slate-200 dark:ring-slate-600 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:ring-2 focus:ring-slate-600 dark:focus:ring-slate-400 transition-all") }}
                            {% if form.state.errors %}
                            <div class="text-red-500 dark:text-red-400 text-sm mt-2">
                                {% for error in form.state.errors %}
                                <p class="flex items-center gap-1">
                                    <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    {{ error }}
                                </p>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div>
                            <label for="{{ form.zip_code.id }}" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">{{ form.zip_code.label }}</label>
                            {{ form.zip_code(class="block w-full rounded-xl border-0 bg-slate-50 dark:bg-slate-700/50 py-3 px-4 text-slate-900 dark:text-slate-100 ring-1 ring-inset ring-slate-200 dark:ring-slate-600 placeholder:text-slate-400 dark:placeholder:text-slate-500 focus:ring-2 focus:ring-slate-600 dark:focus:ring-slate-400 transition-all") }}
                            {% if form.zip_code.errors %}
                            <div class="text-red-500 dark:text-red-400 text-sm mt-2">
                                {% for error in form.zip_code.errors %}
                                <p class="flex items-center gap-1">
                                    <svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    {{ error }}
                                </p>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="mt-10 pt-6 border-t border-slate-100 dark:border-slate-700 flex flex-col sm:flex-row sm:justify-end gap-3">
                    <a href="{{ url_for('clients.index') }}" 
                       class="inline-flex items-center justify-center gap-2 rounded-xl bg-slate-100 dark:bg-slate-700 px-6 py-3 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-all duration-200">
                        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        Cancel
                    </a>
                    <button type="submit" 
                            class="inline-flex items-center justify-center gap-2 rounded-xl bg-slate-900 dark:bg-slate-700 px-6 py-3 text-sm font-medium text-white shadow-lg hover:bg-slate-800 dark:hover:bg-slate-600 transition-all duration-200 hover:scale-105">
                        <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        {% if client %}Update Client{% else %}Create Client{% endif %}
                    </button>
                </div>
                
                {% if client %}
                <input type="hidden" id="client-id" value="{{ client.id }}">
                {% endif %}
            </form>
        </div>
        
        <!-- Form Hints -->
        <div class="mt-8 rounded-2xl bg-slate-50 p-6 ring-1 ring-slate-200">
            <div class="flex items-start gap-3">
                <div class="flex h-8 w-8 items-center justify-center rounded-lg bg-slate-100">
                    <svg class="h-4 w-4 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-slate-900 mb-2">Tips for Client Information</h3>
                    <ul class="space-y-1 text-sm text-slate-600">
                        <li class="flex items-start gap-2">
                            <span class="text-red-500 font-medium">*</span>
                            <span>Required fields must be completed</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="w-2 h-2 rounded-full bg-slate-300 mt-2 flex-shrink-0"></span>
                            <span>Valid phone numbers enable SMS notifications</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="w-2 h-2 rounded-full bg-slate-300 mt-2 flex-shrink-0"></span>
                            <span>Complete addresses help with service scheduling and routing</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        if (!form) return;
        
        // Add validation indicator on input changes
        const inputs = form.querySelectorAll('input');
        inputs.forEach(input => {
            input.addEventListener('change', function() {
                if (this.value.trim() !== '') {
                    this.classList.add('border-green-300');
                } else {
                    this.classList.remove('border-green-300');
                }
            });
        });
        
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address1: document.getElementById('address1').value,
                address2: document.getElementById('address2').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                zip_code: document.getElementById('zip_code').value
            };

            try {
                const formAction = document.getElementById('form-action').value;
                const isUpdate = formAction === 'update';
                const clientId = isUpdate ? document.getElementById('client-id').value : '';
                
                const url = isUpdate ? `/api/clients/${clientId}` : '/api/clients';
                const method = isUpdate ? 'PUT' : 'POST';

                // Show processing state
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalBtnText = submitBtn.innerHTML;
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-1.5"></i> Processing...';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                if (response.ok) {
                    showToast(`Client ${isUpdate ? 'updated' : 'created'} successfully`);
                    window.location.href = '/clients';
                } else {
                    const data = await response.json();
                    showToast(data.error || 'An error occurred', 'error');
                    
                    // Reset button
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalBtnText;
                }
            } catch (error) {
                showToast('An error occurred', 'error');
                
                // Reset button on error
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-save mr-1.5"></i> {% if client %}Update Client{% else %}Create Client{% endif %}';
            }
        });
    });
</script>
{% endblock %} 